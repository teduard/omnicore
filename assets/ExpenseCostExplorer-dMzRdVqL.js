import{r as l,a2 as w,l as y,j as e,H,S,p as B,B as $,L as F,o as R,R as m,A as M,E as b,n as T,c as _,ag as k,ai as z}from"./index-B5AYm2nq.js";import{T as N}from"./index-_4hon0o-.js";import{M as P}from"./MonthPicker-ejs9pz0y.js";import{E as U}from"./ExpenseLayout-DZ0FmJlf.js";import"./internal-kWFzOJjt.js";function Y(s){const c=l.useContext(w),{defaultCurrency:u}=c;return l.useEffect(()=>{y.debug("props.LoadingStatus= ",s.LoadingStatus)},[s.LoadingStatus]),e.jsx(N,{loading:s.LoadingStatus==="loading",loadingText:"Loading expenses",renderAriaLive:({firstIndex:n,lastIndex:x,totalItemsCount:p})=>`Displaying items ${n} to ${x} of ${p}`,columnDefinitions:[{id:"entryDate",header:"Entry Date",cell:n=>e.jsx(F,{href:"/expense/edit/"+n.expenseId,children:n.entryDate||"-"}),sortingField:"name",isRowHeader:!0},{id:"amount",header:"Amount",cell:n=>`${n.amount} ${u.value}`||"-",sortingField:"alt"},{id:"category",header:"Category",cell:n=>n.category||"-"},{id:"comment",header:"Comment",cell:n=>n.comment||"-"},{id:"avoidable",header:"Avoidable",cell:n=>n.couldHaveBeenAvoided?e.jsx(R,{name:"status-warning"}):""}],enableKeyboardNavigation:!0,items:s.expenseData,sortingDisabled:!0,stripedRows:!0,stickyHeader:!0,empty:e.jsx(B,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:e.jsxs(S,{size:"m",children:[e.jsx("b",{children:"No expense items"}),e.jsx($,{children:"Add expense"})]})}),header:e.jsx(H,{actions:e.jsx(S,{direction:"horizontal",size:"xs",children:e.jsx(P,{onRefresh:function(){y.debug("mnth picker"),s.onMonthChange()}})}),children:"Your Expenses"})})}const A={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function G({updateCategoryAggregate:s}){const c=l.useContext(T);if(!c)throw new Error("useAuth must be used within AuthProvider");const{user:u}=c,{execute:n,isReady:x}=_(),{selectedDate:p}=k(),E={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[I,C]=m.useState(E),[r,D]=m.useState(new Array),[L,v]=m.useState(new Array),j=()=>{y.debug("refresh data in updateExpenseHandler"),C({...E,LoadingStatus:"loading"}),s({...A,LoadingStatus:"loading"}),v([]);const g=p.split("-"),f=parseInt(g[0]),h=parseInt(g[1]),d=new Date(f,h,0),t=`${d.getFullYear()}-${d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1}-${d.getDate()}}`,a=n(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
where e.user_id = ${u.UserId}
and e.created_date >= '${p}-01' and e.created_date <= '${t}'
      `),i=new Array;!a||a.length===0?(y.debug("no expenses on local"),D([])):(a[0].values.map(o=>{i.push({expenseId:o[0],entryDate:o[6],amount:o[3],category:{name:o[8],categoryId:o[9]},comment:o[4],couldHaveBeenAvoided:o[5]})}),D(i))};return l.useEffect(()=>{const g=new Array;r.forEach(t=>{const a={expenseId:t.expenseId,entryDate:t.entryDate,amount:t.amount,category:t.category.name,comment:t.comment,couldHaveBeenAvoided:t.couldHaveBeenAvoided};g.push(a)}),v(g),C({ExpenseItemsCount:r.length,CouldHaveBeenAvoidedCount:r.filter(t=>t.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const f=r.reduce((t,a)=>t+a.amount,0).toFixed(2),h=new Array;r.reduce((t,a)=>t.add(a.category.name),new Set).forEach(t=>{const a={categoryName:t,categoryAmount:0};a.categoryAmount=parseFloat(r.filter(i=>i.category.name===t).reduce((i,o)=>i+o.amount,0).toFixed(2)),h.push(a)}),s({...A,expenseAggregate:h,expenseTotal:f||0,LoadingStatus:"success"})},[r]),l.useEffect(()=>{x&&j()},[x]),e.jsx(e.Fragment,{children:e.jsxs(z,{gridDefinition:[{colspan:{default:12}}],children:[!1,e.jsx(Y,{expenseData:L,LoadingStatus:I.LoadingStatus,onMonthChange:j})]})})}function K(){return e.jsx(M,{items:[{text:"Dashboard",href:b.path},{text:"All expenses",href:`${b.path}/cost`}]})}function X(){const s=n=>{u(n)},[c,u]=m.useState(A);return e.jsx(e.Fragment,{children:e.jsx(U,{content:e.jsx(G,{updateCategoryAggregate:s}),breadcrumbs:e.jsx(K,{})})})}export{X as default};
