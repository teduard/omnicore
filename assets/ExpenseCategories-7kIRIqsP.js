import{r,d as C,a as _,u as v,j as e,H as E,S as m,B as d,E as n,e as I,f as A,l as g,A as D,D as $}from"./index-B5h-64n8.js";import{E as B}from"./ExpenseLayout-CmQ90yTE.js";import{T as k}from"./index-DtL_rSmH.js";import{B as L}from"./index-C2wDvPn0.js";function S(){const l=r.useContext(C);if(!l)throw new Error("useAuth must be used within AuthProvider");const{user:p}=l,{execute:u,isReady:x}=_(),h=v(),b=[],[o,f]=r.useState(b),c=()=>{const t=new Array,s=u(`
       select c.*, count(e.expense_id) as expense_count from Categories c
left join Expenses e
on c.user_id = e.user_id and c.category_id = e.category_id
where c.user_id =${p.UserId}
group by c.category_id
      
      `);!s||s.length===0?g.debug("no categories"):(s[0].values.map(i=>{t.push({category_id:i[0],user_id:i[1],name:i[2],created_date:i[3],expense_count:i[4]})}),f(t))};r.useEffect(()=>{x&&c()},[x]);const[a,y]=r.useState([]),j=t=>{switch(console.info(t),t.detail.id){case"edit":g.debug("edit category");break;case"delete":u(`DELETE FROM Categories where category_id = '${a[0].category_id}'`),c();break}};return e.jsx(e.Fragment,{children:e.jsx(k,{renderAriaLive:({firstIndex:t,lastIndex:s,totalItemsCount:i})=>`Displaying items ${t} to ${s} of ${i}`,onSelectionChange:({detail:t})=>y(t.selectedItems),selectedItems:a,ariaLabels:{selectionGroupLabel:"Items selection",allItemsSelectionLabel:()=>"select all",itemSelectionLabel:({selectedItems:t},s)=>s.name},columnDefinitions:[{id:"variable",header:"Name",cell:t=>t.name,isRowHeader:!0},{id:"value",header:"Creation date",cell:t=>t.created_date},{id:"description",header:"Number of expenses",cell:t=>t.expense_count}],columnDisplay:[{id:"variable",visible:!0},{id:"value",visible:!0},{id:"type",visible:!0},{id:"description",visible:!0}],enableKeyboardNavigation:!0,items:o,loadingText:"Loading categories",selectionType:"single",trackBy:"name",empty:e.jsx(A,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:e.jsxs(m,{size:"m",children:[e.jsx("b",{children:"No category"}),e.jsx(d,{onClick:()=>h(`${n.path}/categories/add`),children:"Add category"})]})}),header:e.jsx(E,{counter:a.length?"("+a.length+`/${o.length})`:`(${o.length})`,actions:e.jsxs(m,{direction:"horizontal",size:"xs",children:[e.jsx(L,{onItemClick:j,items:[{text:"Edit",id:"edit",disabled:!1},{text:"Delete",id:"delete",disabled:!(a&&a[0]&&a[0].expense_count==0)}],children:"Actions"}),e.jsx(d,{variant:"primary",onClick:()=>h(`/${n.path}/categories/add`),children:"Add category"}),e.jsxs(d,{onClick:c,children:[" ",e.jsx(I,{name:"refresh"})]})]}),children:"Your categories"})})})}function w(){return e.jsx(D,{items:[{text:"Dashboard",href:$.path},{text:"Expense",href:`${n.path}`},{text:"All Categories",href:`${n.path}/categories`}]})}function R(){return e.jsx(e.Fragment,{children:e.jsx(S,{})})}function H(){return e.jsx(e.Fragment,{children:e.jsx(B,{content:e.jsx(R,{}),breadcrumbs:e.jsx(w,{})})})}export{H as default};
