import{r as g,a1 as I,j as e,H as w,S as j,o as B,B as H,L as $,n as F,R as m,b as R,f as M,E as S,A as T,c as _,ah as k,ai as N}from"./index-DhoDqbO4.js";import{T as z}from"./index-DFzylMm4.js";import{M as G}from"./MonthPicker-C_oCAVXN.js";import{E as U}from"./ExpenseLayout-BUpx8lid.js";import"./internal-DeMV-7eK.js";function Y(n){const r=g.useContext(I),{defaultCurrency:u}=r;return g.useEffect(()=>{console.log("props.LoadingStatus= ",n.LoadingStatus)},[n.LoadingStatus]),e.jsx(z,{loading:n.LoadingStatus==="loading",loadingText:"Loading expenses",renderAriaLive:({firstIndex:a,lastIndex:x,totalItemsCount:p})=>`Displaying items ${a} to ${x} of ${p}`,columnDefinitions:[{id:"entryDate",header:"Entry Date",cell:a=>e.jsx($,{href:"/expense/edit/"+a.expenseId,children:a.entryDate||"-"}),sortingField:"name",isRowHeader:!0},{id:"amount",header:"Amount",cell:a=>`${a.amount} ${u.value}`||"-",sortingField:"alt"},{id:"category",header:"Category",cell:a=>a.category||"-"},{id:"comment",header:"Comment",cell:a=>a.comment||"-"},{id:"avoidable",header:"Avoidable",cell:a=>a.couldHaveBeenAvoided?e.jsx(F,{name:"status-warning"}):""}],enableKeyboardNavigation:!0,items:n.expenseData,sortingDisabled:!0,stripedRows:!0,stickyHeader:!0,empty:e.jsx(B,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:e.jsxs(j,{size:"m",children:[e.jsx("b",{children:"No expense items"}),e.jsx(H,{children:"Add expense"})]})}),header:e.jsx(w,{actions:e.jsx(j,{direction:"horizontal",size:"xs",children:e.jsx(G,{onRefresh:function(){console.log("mnth picker"),n.onMonthChange()}})}),children:"Your Expenses"})})}const y={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function K({updateCategoryAggregate:n}){const r=g.useContext(T),{user:u}=r,{execute:a,isReady:x}=_(),{selectedDate:p}=k(),A={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[L,E]=m.useState(A),[d,C]=m.useState(new Array),[b,D]=m.useState(new Array),v=()=>{E({...A,LoadingStatus:"loading"}),n({...y,LoadingStatus:"loading"}),D([]);const l=p.split("-"),f=parseInt(l[0]),h=parseInt(l[1]),c=new Date(f,h,0),t=`${c.getFullYear()}-${c.getMonth()<9?"0"+(c.getMonth()+1):c.getMonth()+1}-${c.getDate()}}`,s=a(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
where e.user_id = ${u.UserId}
and e.created_date >= '${p}-01' and e.created_date <= '${t}'
      `),i=new Array;!s||s.length===0?(console.log("no expenses on local"),C([])):(s[0].values.map(o=>{i.push({expenseId:o[0],entryDate:o[6],amount:o[3],category:{name:o[8],categoryId:o[9]},comment:o[4],couldHaveBeenAvoided:o[5]})}),C(i))};return g.useEffect(()=>{const l=new Array;d.forEach(t=>{const s={expenseId:t.expenseId,entryDate:t.entryDate,amount:t.amount,category:t.category.name,comment:t.comment,couldHaveBeenAvoided:t.couldHaveBeenAvoided};l.push(s)}),D(l),E({ExpenseItemsCount:d.length,CouldHaveBeenAvoidedCount:d.filter(t=>t.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const f=d.reduce((t,s)=>t+s.amount,0).toFixed(2),h=new Array;d.reduce((t,s)=>t.add(s.category.name),new Set).forEach(t=>{const s={categoryName:t,categoryAmount:0};s.categoryAmount=parseFloat(d.filter(i=>i.category.name===t).reduce((i,o)=>i+o.amount,0).toFixed(2)),h.push(s)}),n({...y,expenseAggregate:h,expenseTotal:f||0,LoadingStatus:"success"})},[d]),g.useEffect(()=>{x&&v()},[x]),e.jsx(e.Fragment,{children:e.jsxs(N,{gridDefinition:[{colspan:{default:12}}],children:[!1,e.jsx(Y,{expenseData:b,LoadingStatus:L.LoadingStatus,onMonthChange:v})]})})}function P(){const n=R();return e.jsx(M,{items:[{text:"Dashboard",href:S.path},{text:"All expenses",href:`${S.path}/cost`}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:r=>{r.detail.external||(r.preventDefault(),n(r.detail.href))}})}function X(){const n=a=>{u(a)},[r,u]=m.useState(y);return e.jsx(e.Fragment,{children:e.jsx(U,{content:e.jsx(K,{updateCategoryAggregate:n}),breadcrumbs:e.jsx(P,{})})})}export{X as default};
