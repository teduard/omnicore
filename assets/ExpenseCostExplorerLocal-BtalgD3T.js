import{R as i,j as a,u as C,c as S,E as f,o as I,r as y,U as L}from"./index-DsalCC-2.js";import{E as j}from"./ExpenseCostExplorerTable-CJqOcVQ9.js";import{E as b}from"./ExpenseLayout-DRFFC9Db.js";import"./index-Cc3eu15F.js";import"./MonthPicker-7lGlcFnm.js";import"./internal-D0E5hLO_.js";const p={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function B({updateCategoryAggregate:r}){const{execute:c,isReady:u}=I(),g={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[h,x]=i.useState(g),[n,E]=i.useState(new Array),[A,m]=i.useState(new Array),D=()=>{x({...g,LoadingStatus:"loading"}),r({...p,LoadingStatus:"loading"}),m([]);const o=c(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
      `),d=new Array;console.log("res = ",o),!o||o.length===0?console.log("no expenses on local"):(o[0].values.map(t=>{d.push({expenseId:t[0],entryDate:t[6],amount:t[3],category:{name:t[8],categoryId:t[9]},comment:t[4],couldHaveBeenAvoided:t[5]})}),console.log("expenseData:",d),E(d))};return y.useEffect(()=>{const o=new Array;n.forEach(e=>{const s={expenseId:e.expenseId,entryDate:e.entryDate,amount:e.amount,category:e.category.name,comment:e.comment,couldHaveBeenAvoided:e.couldHaveBeenAvoided};o.push(s)}),m(o),x({ExpenseItemsCount:n.length,CouldHaveBeenAvoidedCount:n.filter(e=>e.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const d=n.reduce((e,s)=>e+s.amount,0).toFixed(2),t=new Array;n.reduce((e,s)=>e.add(s.category.name),new Set).forEach(e=>{const s={categoryName:e,categoryAmount:0};s.categoryAmount=parseFloat(n.filter(l=>l.category.name===e).reduce((l,v)=>l+v.amount,0).toFixed(2)),t.push(s)}),r({...p,expenseAggregate:t,expenseTotal:d||0,LoadingStatus:"success"})},[n]),y.useEffect(()=>{u&&D()},[u]),a.jsx(a.Fragment,{children:a.jsxs(L,{gridDefinition:[{colspan:{default:12}}],children:[!1,a.jsx(j,{expenseData:A,LoadingStatus:h.LoadingStatus})]})})}function w(){const r=C();return a.jsx(S,{items:[{text:"Dashboard",href:f.path},{text:"All expenses",href:`${f.path}/cost`}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:c=>{c.detail.external||(c.preventDefault(),r(c.detail.href))}})}function $(){const r=g=>{u(g)},[c,u]=i.useState(p);return a.jsx(a.Fragment,{children:a.jsx(b,{content:a.jsx(B,{updateCategoryAggregate:r}),breadcrumbs:a.jsx(w,{})})})}export{$ as default};
