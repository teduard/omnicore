import{R as i,j as t,u as C,a as D,E as h,r as y,B as I,ao as S}from"./index-Bj2MUn9q.js";import{E as b}from"./ExpenseCostExplorerTable-Bz1xMVAQ.js";import{E as L}from"./ExpenseLayout-DQHk7F6L.js";import{u as B}from"./useDatabase-Ddn2wrX2.js";import{I as w}from"./index-B_T0Znjq.js";import"./MonthPicker-CkXXlndD.js";import"./internal-CSiE5gFz.js";import"./index-Ccz6MWjI.js";const l={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function H({updateCategoryAggregate:r}){const{execute:c,isReady:u}=B(),g={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[E,x]=i.useState(g),[n,A]=i.useState(new Array),[j,m]=i.useState(new Array),f=()=>{x({...g,LoadingStatus:"loading"}),r({...l,LoadingStatus:"loading"}),m([]);const o=c(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
      `),d=new Array;console.log("res = ",o),!o||o.length===0?console.log("no expenses on local"):(o[0].values.map(a=>{d.push({expenseId:a[0],entryDate:a[6],amount:a[3],category:{name:a[8],categoryId:a[9]},comment:a[4],couldHaveBeenAvoided:a[5]})}),console.log("expenseData:",d),A(d))};return y.useEffect(()=>{const o=new Array;n.forEach(e=>{const s={expenseId:e.expenseId,entryDate:e.entryDate,amount:e.amount,category:e.category.name,comment:e.comment,couldHaveBeenAvoided:e.couldHaveBeenAvoided};o.push(s)}),m(o),x({ExpenseItemsCount:n.length,CouldHaveBeenAvoidedCount:n.filter(e=>e.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const d=n.reduce((e,s)=>e+s.amount,0).toFixed(2),a=new Array;n.reduce((e,s)=>e.add(s.category.name),new Set).forEach(e=>{const s={categoryName:e,categoryAmount:0};s.categoryAmount=parseFloat(n.filter(p=>p.category.name===e).reduce((p,v)=>p+v.amount,0).toFixed(2)),a.push(s)}),r({...l,expenseAggregate:a,expenseTotal:d||0,LoadingStatus:"success"})},[n]),y.useEffect(()=>{u&&f()},[u]),t.jsxs(t.Fragment,{children:[t.jsxs(I,{variant:"primary",onClick:f,children:[t.jsx(w,{name:"refresh"}),"  Refresh"]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs(S,{gridDefinition:[{colspan:{default:12}}],children:[!1,t.jsx(b,{expenseData:j,LoadingStatus:E.LoadingStatus})]})]})}function F(){const r=C();return t.jsx(D,{items:[{text:"Dashboard",href:h.path},{text:"All expenses",href:`${h.path}/cost`}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:c=>{c.detail.external||(c.preventDefault(),r(c.detail.href))}})}function K(){const r=g=>{u(g)},[c,u]=i.useState(l);return t.jsx(t.Fragment,{children:t.jsx(L,{content:t.jsx(H,{updateCategoryAggregate:r}),breadcrumbs:t.jsx(F,{})})})}export{K as default};
