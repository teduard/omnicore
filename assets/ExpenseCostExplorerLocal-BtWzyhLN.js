import{R as l,j as a,u as w,d as B,E as S,r as x,A as F,o as H,N as $,O as R}from"./index-C0ZLi_SD.js";import{E as _}from"./ExpenseCostExplorerTable-9IKRrlEh.js";import{E as T}from"./ExpenseLayout-mFmVsxmw.js";import"./index-B730hVk3.js";import"./MonthPicker-DWJqdzA6.js";import"./internal-DnwP_V4T.js";const m={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function M({updateCategoryAggregate:r}){const c=x.useContext(F),{isAuthenticated:h,setIsAuthenticated:y,user:v,setUser:G}=c,{execute:L,isReady:f}=H(),{selectedDate:i,updateDate:U}=$(),E={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[j,A]=l.useState(E),[n,D]=l.useState(new Array),[b,C]=l.useState(new Array),I=()=>{console.log("FIRST"),A({...E,LoadingStatus:"loading"}),r({...m,LoadingStatus:"loading"}),C([]),console.log("selectedDate = ",i);const u=i.split("-"),p=parseInt(u[0]),g=parseInt(u[1]),d=new Date(p,g,0),e=`${d.getFullYear()}-${d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1}-${d.getDate()}}`,t=L(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
where e.user_id = ${v.UserId}
and e.created_date >= '${i}-01' and e.created_date <= '${e}'
      `),o=new Array;console.log("res = ",t),!t||t.length===0?(console.log("no expenses on local"),D([])):(t[0].values.map(s=>{o.push({expenseId:s[0],entryDate:s[6],amount:s[3],category:{name:s[8],categoryId:s[9]},comment:s[4],couldHaveBeenAvoided:s[5]})}),console.log("expenseData:",o),D(o))};return x.useEffect(()=>{const u=new Array;n.forEach(e=>{const t={expenseId:e.expenseId,entryDate:e.entryDate,amount:e.amount,category:e.category.name,comment:e.comment,couldHaveBeenAvoided:e.couldHaveBeenAvoided};u.push(t)}),C(u),A({ExpenseItemsCount:n.length,CouldHaveBeenAvoidedCount:n.filter(e=>e.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const p=n.reduce((e,t)=>e+t.amount,0).toFixed(2),g=new Array;n.reduce((e,t)=>e.add(t.category.name),new Set).forEach(e=>{const t={categoryName:e,categoryAmount:0};t.categoryAmount=parseFloat(n.filter(o=>o.category.name===e).reduce((o,s)=>o+s.amount,0).toFixed(2)),g.push(t)}),r({...m,expenseAggregate:g,expenseTotal:p||0,LoadingStatus:"success"})},[n]),x.useEffect(()=>{f&&I()},[f]),a.jsx(a.Fragment,{children:a.jsxs(R,{gridDefinition:[{colspan:{default:12}}],children:[!1,a.jsx(_,{expenseData:b,LoadingStatus:j.LoadingStatus,onMonthChange:I})]})})}function N(){const r=w();return a.jsx(B,{items:[{text:"Dashboard",href:S.path},{text:"All expenses",href:`${S.path}/cost`}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:c=>{c.detail.external||(c.preventDefault(),r(c.detail.href))}})}function P(){const r=y=>{h(y)},[c,h]=l.useState(m);return a.jsx(a.Fragment,{children:a.jsx(T,{content:a.jsx(M,{updateCategoryAggregate:r}),breadcrumbs:a.jsx(N,{})})})}export{P as default};
