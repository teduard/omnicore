const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/highcharts-BVNvI6Be.js","assets/index-C0ZLi_SD.js","assets/index-uu3zVhp3.css","assets/accessibility-XSr-RJJ4.js","assets/highcharts-more-DPvGWNW9.js"])))=>i.map(i=>d[i]);
import{s as k,R as o,t as re,v as L,w as ie,x as ce,f as de,i as ue,y as q,r as c,z as ge,G as ee,J as te,K as he,n as pe,j as t,C as H,H as T,q as w,U as Z,L as G,_ as U,S as $,u as me,d as xe,D as Ce,E as fe,o as _e,N as Ee,M as ye,e as Pe,O as W}from"./index-C0ZLi_SD.js";import{S as I,c as ve,a as be,b as we,d as Ae,e as De,f as Se,g as je,h as Ie,i as Le,j as Te,k as Be,l as Ne,m as Re,n as Fe,o as Me,p as ke,q as $e,r as He,s as ze,t as Ve,u as Oe,v as Ye,w as qe,x as Ue,y as We,z as Ke,A as Ge,B as Ze,C as Je,D as Qe,E as Xe,F as et,G as tt,H as at,I as st,J as rt,K as ot,L as nt,M as lt,N as it,O as ct,P as dt,Q as ut,R as gt,T as ht,U as pt,V as mt,W as xt,X as Ct,Y as ft,Z as _t}from"./index-DBORwpd-.js";import{T as J}from"./index-B730hVk3.js";import{a as Et}from"./index-CBvmKZKe.js";import{M as yt}from"./MonthPicker-DWJqdzA6.js";import{E as Pt}from"./ExpenseLayout-mFmVsxmw.js";import"./internal-DnwP_V4T.js";function vt(e){if(e?.progressBar)return{[k.progressBarBackgroundColor]:e.progressBar.backgroundColor,[k.progressBarBorderRadius]:e.progressBar.borderRadius,[k.progressBarHeight]:e.progressBar.height}}function bt(e){if(e?.progressValue)return{[k.progressValueBackgroundColor]:e.progressValue.backgroundColor}}function wt(e){if(e?.progressPercentage)return{color:e.progressPercentage.color,fontSize:e.progressPercentage.fontSize,fontWeight:e.progressPercentage.fontWeight}}const u={progress:"awsui_progress_11huc_1oe95_189","result-state":"awsui_result-state_11huc_1oe95_203","awsui-motion-fade-in":"awsui_awsui-motion-fade-in_11huc_1oe95_1",root:"awsui_root_11huc_1oe95_225","with-result-button":"awsui_with-result-button_11huc_1oe95_257","result-text":"awsui_result-text_11huc_1oe95_261","result-container-error":"awsui_result-container-error_11huc_1oe95_265","result-container-success":"awsui_result-container-success_11huc_1oe95_265","result-button":"awsui_result-button_11huc_1oe95_269","word-wrap":"awsui_word-wrap_11huc_1oe95_275","label-flash":"awsui_label-flash_11huc_1oe95_280","label-key-value":"awsui_label-key-value_11huc_1oe95_284",flash:"awsui_flash_11huc_1oe95_292","progress-container":"awsui_progress-container_11huc_1oe95_296","percentage-container":"awsui_percentage-container_11huc_1oe95_303",percentage:"awsui_percentage_11huc_1oe95_303",complete:"awsui_complete_11huc_1oe95_349","additional-info":"awsui_additional-info_11huc_1oe95_363"},K=100,At=(e,s,a)=>Math.max(Math.min(e,a),s),Dt=({value:e,isInFlash:s,ariaLabel:a,ariaLabelledby:r,ariaDescribedby:n,style:g})=>{const i=Math.round(e),d=At(i,0,K),h=vt(g),f=bt(g),A=wt(g);return o.createElement("div",{className:u["progress-container"]},o.createElement("progress",{className:L(u.progress,d>=K&&u.complete),max:K,value:d,"aria-label":a,"aria-labelledby":a?void 0:r,"aria-describedby":n,style:{...h||{},...f||{}}}),o.createElement("span",{"aria-hidden":"true",className:u["percentage-container"]},o.createElement(re,{className:u.percentage,variant:"small",color:s?"inherit":void 0,nativeAttributes:A?{style:A}:void 0},`${d}%`)))},ae=({color:e,children:s,className:a,id:r})=>o.createElement(re,{className:L(u["word-wrap"],a),variant:"small",display:"block",color:e,id:r},s),St=({onClick:e,children:s})=>o.createElement("div",{className:u["result-button"]},o.createElement(ce,{formAction:"none",onClick:e},s)),jt=({isInFlash:e,resultText:s,resultButtonText:a,status:r,onClick:n})=>{const g=!!a;return e?o.createElement("div",{className:u[`result-container-${r}`]},o.createElement("span",{className:u["result-text"]},s)):o.createElement("div",{className:u[`result-container-${r}`]},o.createElement("span",{className:L(g&&u["with-result-button"])},o.createElement(ie,{type:r==="success"?"success":"error"},o.createElement("span",{className:u["result-text"]},s))),g&&o.createElement(St,{onClick:n},a))},It=5e3;function oe({value:e=0,status:s="in-progress",variant:a="standalone",resultButtonText:r,label:n,ariaLabel:g,ariaLabelledby:i,ariaDescribedby:d,description:h,additionalInfo:f,resultText:A,onResultButtonClick:S,style:v,...B}){const{__internalRootRef:N}=de("ProgressBar",{props:{variant:a}}),z=ue(B),_=`${q("awsui-progress-bar-")}-label`,b=a==="flash",V=s==="in-progress",R=q("progressbar-description-"),j=q("progressbar-additional-info-"),[F,m]=c.useState(""),E=ge(x=>{m(`${x}%`)},It,[]);return c.useEffect(()=>{E(e)},[E,e]),o.createElement("div",{...z,className:L(z.className,u.root,a&&u[a]),ref:N},o.createElement("div",{className:b?u["flash-container"]:void 0},o.createElement("div",{className:L(u["word-wrap"],u[`label-${a}`]),id:_},n),h&&o.createElement(ae,{color:b?"inherit":void 0,id:R},h),o.createElement("div",null,V?o.createElement(o.Fragment,null,o.createElement(Dt,{value:e,ariaLabel:g,ariaLabelledby:ee(_,i),ariaDescribedby:ee(h?R:void 0,f?j:void 0,d),isInFlash:b,style:v}),o.createElement(te,{hidden:!0,tagName:"span",delay:0},n,n?": ":null,F)):o.createElement(te,{hidden:!1,tagName:"span",delay:0},o.createElement(jt,{resultText:A,isInFlash:b,resultButtonText:r,status:s,onClick:()=>{he(S)}})))),f&&o.createElement(ae,{className:u["additional-info"],color:b?"inherit":void 0,id:j},f))}pe(oe,"ProgressBar");function Lt(){const[e,s]=c.useState(!0);return c.useEffect(()=>{function a(){console.log("in hook, handle online"),s(!0)}function r(){console.log("in hook, handle offline"),s(!1)}return window.addEventListener("online",a),window.addEventListener("offline",r),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",r)}},[]),e}function Tt({insightsDefinition:e,insightsItems:s,loadingStatus:a}){return a==="not-started"?t.jsx(w,{textAlign:"center",children:t.jsx(I,{type:"info",children:"Insights not loaded. Reload page"})}):a==="loading"?t.jsx(w,{textAlign:"center",children:t.jsx(I,{type:"loading",children:"Loading"})}):a==="error"?t.jsx(w,{textAlign:"center",children:t.jsx(I,{type:"error",children:"Error loading insights"})}):t.jsx(J,{enableKeyboardNavigation:!0,variant:"borderless",resizableColumns:!0,items:s,columnDefinitions:e})}function Bt(e){const s=[{id:"name",header:"Metric",cell:r=>r.name,width:160,isRowHeader:!0},{id:"status",header:"Count",cell:({statusText:r,status:n})=>t.jsx(I,{type:n,children:r})}],a=[{name:"Total transactions",statusText:e.ExpenseItemsCount.toString(),status:"info"},{name:"Avoidable expenses",statusText:e.CouldHaveBeenAvoidedCount.toString(),status:"warning"}];return t.jsx(H,{header:t.jsx(T,{variant:"h2",description:"What to look after",children:"Insights"}),children:t.jsx(Tt,{insightsDefinition:s,insightsItems:a,loadingStatus:e.LoadingStatus})})}function Nt(e){const[s,a]=o.useState(),r=c.useContext(Z),{defaultCurrency:n}=r,g=[{id:"name",header:"Category",cell:i=>t.jsx(G,{href:"#",children:i.name}),width:160,isRowHeader:!0},{id:"status",header:"Total Spent",cell:({statusText:i,status:d})=>`${i} ${n.value}`,width:140},{id:"quota",header:"Budget quota",cell:({statusText:i,status:d})=>t.jsxs(t.Fragment,{children:[t.jsx(I,{type:d,children:"30%"})," ","/"," ",parseFloat(i)*2," ",n.value]})}];return c.useEffect(()=>{const i=new Array;e.expenseAggregate.forEach(h=>{i.push({name:h.categoryName,statusText:h.categoryAmount.toString(),status:"info"})}),a(i)},[e.expenseAggregate]),t.jsx(H,{header:t.jsx(T,{variant:"h2",description:"Transactions aggregated by category",children:"Category summary"}),children:t.jsx(J,{enableKeyboardNavigation:!0,variant:"borderless",resizableColumns:!0,items:s,columnDefinitions:g,loading:e.LoadingStatus==="loading",loadingText:"Loading category aggregates",footer:t.jsx(w,{textAlign:"center",children:t.jsxs("h3",{children:["Total: ",t.jsxs("b",{children:[e.expenseTotal," ",n.value]})]})})})})}const se=e=>`${(e*100).toFixed(0)}%`,Rt=()=>{const[e,s]=c.useState(null);return c.useEffect(()=>{(async()=>{const r=await U(()=>import("./highcharts-BVNvI6Be.js").then(n=>n.h),__vite__mapDeps([0,1,2]));await U(()=>import("./accessibility-XSr-RJJ4.js").then(n=>n.a),__vite__mapDeps([3,1,2])),await U(()=>import("./highcharts-more-DPvGWNW9.js").then(n=>n.h),__vite__mapDeps([4,1,2])),s(r)})()},[]),e},Ft=[ve,be,we,Ae,De,Se,je,Ie,Le,Te,Be,Ne,Re,Fe,Me,ke,$e,He,ze,Ve,Oe,Ye,qe,Ue,We,Ke,Ge,Ze,Je,Qe,Xe,et,tt,at,st,rt,ot,nt,lt,it,ct,dt,ut,gt,ht,pt,mt,xt,Ct,ft];function Mt(e){const s=c.useContext(Z),{defaultCurrency:a}=s,r=Rt(),[n,g]=c.useState([]);return c.useEffect(()=>{const i=new Array;let d=0;e.expenseAggregate.forEach(h=>{h.categoryAmount>0&&i.push({name:h.categoryName,y:h.categoryAmount,color:Ft[d++]})}),g(i)},[e.expenseAggregate]),t.jsx(t.Fragment,{children:t.jsx(H,{header:t.jsx(T,{variant:"h2",description:"Your expenses at a glance",children:"Expenses aggregate by category"}),children:t.jsx(_t,{highcharts:r,noData:{statusType:"finished",empty:t.jsxs("div",{children:[t.jsx(w,{fontWeight:"bold",textAlign:"center",color:"inherit",children:"No expenses available"}),t.jsx(w,{textAlign:"center",color:"inherit",children:"for the selected period"})]})},series:{type:"donut",name:"Zone status",data:n},ariaLabel:"Category aggregate chart",innerAreaDescription:a.value,innerAreaTitle:e.expenseTotal.toString(),segmentDescription:({segmentValue:i,totalValue:d})=>`${i} zones, ${se(i/d)}`,tooltip:{details:({segmentValue:i,totalValue:d})=>[{key:"Zone count",value:i},{key:"Percentage",value:se(i/d)}]},i18nStrings:{chartRoleDescription:"Pie chart summarizing the status of all zones.",seriesFilterLabel:"Filter displayed data",seriesFilterPlaceholder:"Filter data",seriesFilterSelectedAriaLabel:"selected",detailPopoverDismissAriaLabel:"Dismiss",legendAriaLabel:"Legend",segmentRoleDescription:"segment"}})})})}function kt(e){const s=c.useContext(Z),{defaultCurrency:a}=s;return t.jsx(J,{loading:e.LoadingStatus==="loading",loadingText:"Loading expenses",renderAriaLive:({firstIndex:r,lastIndex:n,totalItemsCount:g})=>`Displaying items ${r} to ${n} of ${g}`,columnDefinitions:[{id:"entryDate",header:"Entry Date",cell:r=>t.jsx(G,{href:"/expense/edit/"+r.expenseId,children:r.entryDate||"-"}),sortingField:"name",isRowHeader:!0},{id:"amount",header:"Amount",cell:r=>`${r.amount} ${a.value}`||"-",sortingField:"alt"},{id:"category",header:"Category",cell:r=>r.category||"-"},{id:"comment",header:"Comment",cell:r=>r.comment||"-"}],enableKeyboardNavigation:!0,items:e.expenseData,sortingDisabled:!0,stripedRows:!0,empty:t.jsx(w,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:t.jsx($,{size:"m",children:t.jsx("b",{children:"No expenses"})})}),header:t.jsx(T,{children:" Latest Expenses "}),footer:t.jsx(w,{textAlign:"center",children:t.jsx(G,{href:"/omnicore/dashboard/expense/costlocal",variant:"primary",children:"View all expenses"})})})}function $t(){const{execute:e,isReady:s}=_e(),{selectedDate:a,updateDate:r}=Ee();Lt();const[n,g]=c.useState("There are 13 days till the end of month: "+a),[i,d]=c.useState(13);c.useEffect(()=>{const m=new Date,E=m.getDate(),x=m.getMonth(),D=m.getFullYear(),l=parseInt(a.split("-")[0]),p=parseInt(a.split("-")[1])-1;if(console.log("DATES: ",D,x,l,p),D==l&&x==p){const y=new Date(D,x,1),P=new Date(D,x,E),C=new Date(l,p+1,0),M=1e3*60*60*24,ne=C.getTime()-P.getTime()+M,O=Math.round(ne/M);console.log(P,C,y),g(`There are ${O} days till the end of month.`);const le=C.getTime()-y.getTime()+M,Y=Math.round(le/M);console.log("DAYS: ",O,Y);const X=(Y-O)/Y*100;console.log("progress:",X),d(X)}else g("This month has passed"),d(100)},[a]);const h={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[f,A]=o.useState(h),S={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"},[v,B]=o.useState(S),[N,z]=c.useState(ye.Light),Q={tokens:{colorBackgroundLayoutMain:{light:"white",dark:"blue"},colorTextAccent:"#0073bb"},contexts:{"top-navigation":{tokens:{colorBackgroundContainerContent:"#1e324f"}}}};c.useEffect(()=>{Pe(N),Et({theme:Q})},[N]);const[_,b]=o.useState(new Array),[V,R]=o.useState(new Array),j=()=>{const m=new Array,E=a.split("-"),x=parseInt(E[0]),D=parseInt(E[1]),l=new Date(x,D,0),p=`${l.getFullYear()}-${l.getMonth()<9?"0"+(l.getMonth()+1):l.getMonth()+1}-${l.getDate()}}`,y=`SELECT e.*,c.name, c.category_id FROM Expenses e
      join Categories c
      on e.category_id = c.category_id
      WHERE 
      e.created_date >= '${a}-01' and e.created_date <= '${p}'
      `;console.log("sql = ",y);const P=e(y);return console.log("fetch expenses. res = ",P),console.log("selectedDate = ",a),!P||P.length===0?console.log("no expenses"):(P[0].values.map(C=>{m.push({expenseId:C[0],category:{name:C[8],categoryId:C[9]},entryDate:C[6],amount:C[3],comment:C[4],couldHaveBeenAvoided:C[5]})}),console.log("catData:",m)),m};c.useEffect(()=>{s&&b(j())},[s]);const F=()=>{console.log("IN updateExpenseHandler"),A({...h,LoadingStatus:"loading"}),B({...S,LoadingStatus:"loading"}),b(j())};return c.useEffect(()=>{const m=new Array;_.forEach(l=>{const p={expenseId:l.expenseId,entryDate:l.entryDate,amount:l.amount,category:l.category.name,comment:l.comment,couldHaveBeenAvoided:l.couldHaveBeenAvoided};m.push(p)}),R(m.slice(Math.max(m.length-10,0))),A({ExpenseItemsCount:_.length,CouldHaveBeenAvoidedCount:_.filter(l=>l.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const E=_.reduce((l,p)=>l+p.amount,0).toFixed(2),x=new Array;_.reduce((l,p)=>l.add(p.category.name),new Set).forEach(l=>{const p={categoryName:l,categoryAmount:0};p.categoryAmount=parseFloat(_.filter(y=>y.category.name===l).reduce((y,P)=>y+P.amount,0).toFixed(2)),x.push(p)}),B({...S,expenseAggregate:x,expenseTotal:E||0,LoadingStatus:"success"})},[_]),c.useEffect(()=>{F()},[]),t.jsx(t.Fragment,{children:t.jsxs(W,{gridDefinition:[{colspan:{default:12}},{colspan:{default:12}}],children:[t.jsx(H,{header:t.jsx(T,{variant:"h1",children:"Current status"}),children:t.jsxs(W,{gridDefinition:[{colspan:{default:12,xs:7}},{colspan:{default:12,xs:5}}],children:[t.jsx("div",{children:t.jsx(oe,{value:i,additionalInfo:n,label:"Month progress"})}),t.jsx($,{direction:"vertical",size:"l",children:t.jsx(yt,{onRefresh:F})})]})}),t.jsxs(W,{gridDefinition:[{colspan:{default:12,m:7,s:8,l:6,xl:6,xxs:12,xs:12}},{colspan:{default:12,m:5,s:4,l:6,xl:6,xxs:12,xs:12}}],children:[t.jsxs($,{size:"l",children:[t.jsx(Mt,{LoadingStatus:v.LoadingStatus,expenseAggregate:v.expenseAggregate,expenseTotal:v.expenseTotal}),t.jsx(kt,{expenseData:V,LoadingStatus:f.LoadingStatus})]}),t.jsxs($,{size:"l",children:[t.jsx(Bt,{ExpenseItemsCount:f.ExpenseItemsCount,CouldHaveBeenAvoidedCount:f.CouldHaveBeenAvoidedCount,LoadingStatus:f.LoadingStatus}),t.jsx(Nt,{LoadingStatus:v.LoadingStatus,expenseAggregate:v.expenseAggregate,expenseTotal:v.expenseTotal})]})]})]})})}function Ht(){const e=me();return t.jsx(xe,{items:[{text:"Dashboard",href:`/omnicore/${Ce.path}/preferences`},{text:"Expense",href:fe.path}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:s=>{if(!s.detail.external){const a=s.detail.href.replace("/omnicore/","/");s.preventDefault(),e(a)}}})}function Kt(){return t.jsx(t.Fragment,{children:t.jsx(Pt,{content:t.jsx($t,{}),breadcrumbs:t.jsx(Ht,{})})})}export{Kt as default};
