import{r as i,_ as E,l as o,j as t,H as C,S as h,f as A,B as D,L as I,e as j,R as g,A as v,E as f,d as w,ac as S,ae as B}from"./index-B5h-64n8.js";import{T as L}from"./index-DtL_rSmH.js";import{M as H}from"./MonthPicker-vkpLPQGS.js";import{b as k,a as R}from"./useExpenses-C5VqX26q.js";import{B as T}from"./index-C2wDvPn0.js";import{E as $}from"./ExpenseLayout-CmQ90yTE.js";function F(n){const c=i.useContext(E),{defaultCurrency:r}=c,[s,l]=i.useState([]),{mutate:p}=k();i.useEffect(()=>{o.debug("props.LoadingStatus= ",n.LoadingStatus)},[n.LoadingStatus]);const u=e=>{switch(console.info(e),e.detail.id){case"edit":o.debug("edit expense: ",s);break;case"delete":o.debug("delete expense: ",s),o.debug("expenseID:",s[0].expenseId),p({expenseId:s[0].expenseId});break}};return t.jsx(L,{loading:n.LoadingStatus==="loading",loadingText:"Loading expenses",renderAriaLive:({firstIndex:e,lastIndex:d,totalItemsCount:x})=>`Displaying items ${e} to ${d} of ${x}`,columnDisplay:[{id:"expenseId",visible:!1},{id:"entryDate",visible:!0},{id:"amount",visible:!0},{id:"category",visible:!0},{id:"comment",visible:!0},{id:"avoidable",visible:!0}],columnDefinitions:[{id:"expenseId",header:"expenseId",cell:e=>e.expenseId,sortingField:"name",isRowHeader:!0},{id:"entryDate",header:"Entry Date",cell:e=>t.jsx(I,{href:"/omnicore/dashboard/expense/edit/"+e.expenseId,children:e.entryDate||"-"}),sortingField:"name",isRowHeader:!0},{id:"amount",header:"Amount",cell:e=>`${e.amount} ${r.value}`||"-",sortingField:"alt"},{id:"category",header:"Category",cell:e=>e.category||"-"},{id:"comment",header:"Comment",cell:e=>e.comment||"-"},{id:"avoidable",header:"Avoidable",cell:e=>e.couldHaveBeenAvoided?t.jsx(j,{name:"status-warning"}):""}],selectedItems:s,onSelectionChange:({detail:e})=>l(e.selectedItems),enableKeyboardNavigation:!0,items:n.expenseData,sortingDisabled:!0,selectionType:"single",trackBy:"expenseId",stripedRows:!0,stickyHeader:!0,empty:t.jsx(A,{margin:{vertical:"xs"},textAlign:"center",color:"inherit",children:t.jsxs(h,{size:"m",children:[t.jsx("b",{children:"No expense items"}),t.jsx(D,{children:"Add expense"})]})}),header:t.jsx(C,{actions:t.jsxs(h,{direction:"horizontal",size:"xs",children:[t.jsx(T,{onItemClick:u,items:[{text:"Edit",id:"edit",disabled:!1},{text:"Delete",id:"delete",disabled:!1}],children:"Actions"}),t.jsx(H,{onRefresh:function(){o.debug("mnth picker"),n.onMonthChange()}})]}),children:"Your Expenses"})})}const M={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function z({updateCategoryAggregate:n}){if(!i.useContext(w))throw new Error("useAuth must be used within AuthProvider");const{selectedDate:r}=S(),s={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[l,p]=g.useState(s),[u,e]=g.useState(new Array),{data:d=[],refetch:x}=R(r);i.useEffect(()=>{o.debug("expense was updated");const m=new Array;d.forEach(a=>{const y={expenseId:a.expenseId,entryDate:a.entryDate,amount:a.amount,category:a.category.name,comment:a.comment,couldHaveBeenAvoided:a.couldHaveBeenAvoided};m.push(y)}),e(m)},[d]);const b=()=>{x()};return t.jsx(t.Fragment,{children:t.jsx(B,{gridDefinition:[{colspan:{default:12}}],children:t.jsx(F,{expenseData:u,LoadingStatus:l.LoadingStatus,onMonthChange:b})})})}function N(){return t.jsx(v,{items:[{text:"Dashboard",href:f.path},{text:"All expenses",href:`${f.path}/cost`}]})}function q(){const n=s=>{r(s)},[c,r]=g.useState(M);return t.jsx(t.Fragment,{children:t.jsx($,{content:t.jsx(z,{updateCategoryAggregate:n}),breadcrumbs:t.jsx(N,{})})})}export{q as default};
