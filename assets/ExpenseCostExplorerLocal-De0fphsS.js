import{R as i,j as a,u as S,d as v,E as f,o as I,r as y,K as L}from"./index-BH-jVFMI.js";import{E as j}from"./ExpenseCostExplorerTable-Da64BOF4.js";import{E as b}from"./ExpenseLayout-CWXf47gE.js";import"./index-DVwEdowm.js";import"./MonthPicker-B6LjpLo2.js";import"./internal-DxlDOgS-.js";const p={expenseAggregate:new Array,expenseTotal:0,LoadingStatus:"not-started"};function w({updateCategoryAggregate:r}){const{execute:c,isReady:u}=I(),g={ExpenseItemsCount:0,CouldHaveBeenAvoidedCount:0,LoadingStatus:"not-started"},[E,x]=i.useState(g),[n,A]=i.useState(new Array),[C,m]=i.useState(new Array),h=()=>{console.log("FIRST"),x({...g,LoadingStatus:"loading"}),r({...p,LoadingStatus:"loading"}),m([]);const o=c(`
      select e.*,c.name, c.category_id from Expenses e
join Categories c
on e.category_id = c.category_id
where e.user_id = 1
      `),d=new Array;console.log("res = ",o),!o||o.length===0?console.log("no expenses on local"):(o[0].values.map(t=>{d.push({expenseId:t[0],entryDate:t[6],amount:t[3],category:{name:t[8],categoryId:t[9]},comment:t[4],couldHaveBeenAvoided:t[5]})}),console.log("expenseData:",d),A(d))};return y.useEffect(()=>{const o=new Array;n.forEach(e=>{const s={expenseId:e.expenseId,entryDate:e.entryDate,amount:e.amount,category:e.category.name,comment:e.comment,couldHaveBeenAvoided:e.couldHaveBeenAvoided};o.push(s)}),m(o),x({ExpenseItemsCount:n.length,CouldHaveBeenAvoidedCount:n.filter(e=>e.couldHaveBeenAvoided===!0).length,LoadingStatus:"success"});const d=n.reduce((e,s)=>e+s.amount,0).toFixed(2),t=new Array;n.reduce((e,s)=>e.add(s.category.name),new Set).forEach(e=>{const s={categoryName:e,categoryAmount:0};s.categoryAmount=parseFloat(n.filter(l=>l.category.name===e).reduce((l,D)=>l+D.amount,0).toFixed(2)),t.push(s)}),r({...p,expenseAggregate:t,expenseTotal:d||0,LoadingStatus:"success"})},[n]),y.useEffect(()=>{u&&h()},[u]),a.jsx(a.Fragment,{children:a.jsxs(L,{gridDefinition:[{colspan:{default:12}}],children:[!1,a.jsx(j,{expenseData:C,LoadingStatus:E.LoadingStatus,onMonthChange:h})]})})}function B(){const r=S();return a.jsx(v,{items:[{text:"Dashboard",href:f.path},{text:"All expenses",href:`${f.path}/cost`}],expandAriaLabel:"Show path",ariaLabel:"Breadcrumbs",onFollow:c=>{c.detail.external||(c.preventDefault(),r(c.detail.href))}})}function M(){const r=g=>{u(g)},[c,u]=i.useState(p);return a.jsx(a.Fragment,{children:a.jsx(b,{content:a.jsx(w,{updateCategoryAggregate:r}),breadcrumbs:a.jsx(B,{})})})}export{M as default};
